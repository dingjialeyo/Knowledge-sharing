<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        div {
            margin-top: 30px;
            width: 200px;
            height: 150px;
            background-color: pink;
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>

<body>
    <input type="button" value="移动到400" id="btn1">
    <input type="button" value="移动到800" id="btn2">
    <div id="dv"></div>




    <script>
        function my$(id) {
            return document.getElementById(id)
        }

        // my$("btn1").onclick = function (){
        //     animate(my$("dv"),400);
        // };
        // my$("btn2").onclick = function (){
        //     animate(my$("dv"),800);
        // };



        //匀速动画函数
        // function animate(ele,target){
        //     //清理定时器
        //     clearInterval(ele.timeId);
        //     ele.timeId = setInterval(function () {  
        //         //获取当前元素位置
        //         var current = ele.offsetLeft;
        //         //移动的步数
        //         var step = 10;
        //         //判断移动距离是否大于当前元素，是为正。
        //         step = target > current ?　step : -step ;
        //         current+=step;
        //         if(Math.abs(current-target)>Math.abs(step)){
        //             ele.style.left = current +"px";
        //         }
        //         else{
        //             clearInterval(ele.timeId);
        //             ele.style.left = target +"px";
        //         }
        //     },10)
        // }
        //封装了一个变速的动画函数
        // function animate(ele,target){
        //     //清理定时器
        //     clearInterval(ele.timeId);
        //     ele.timeId = setInterval(function () {  
        //         //获取当前元素位置
        //         var current = ele.offsetLeft;
        //         //移动的步数
        //         var step = (target-current)/10;
        //         //判断step是否为正数为正向上取整,负数是向下取整。
        //         step = step>0 ? Math.ceil(step) : Math.floor(step);
        //         current+=step;
        //         // 判断是否到达目标
        //         if(current == target){
        //             clearInterval(ele.timeId);
        //         }
        //         else {
        //             ele.style.left = current +"px";
        //         }

        //         //测试代码
        //         console.log("目标位置："+target+"当前位置："+current+"每次移动步数"+step)
        //     },20)
        // };



        //案例筋斗云
        //获取所有的li
        // var list = my$("ul").children;
        // //获取移动的图标
        // var icon = my$("icon");
        // // 遍历所有的li标签注册鼠标进入离开和点击事件
        // for(var i=0;i<list.length;i++){
        //     //循环的函数最好用命名函数减少循环的次数
        //     list[i].onclick = clickHandle;
        //     list[i].onmouseover = mouseoverHandle;
        //     list[i].onmouseout = mouseoutHandle;
        // }
        // function mouseoverHandle(){
        //     //进入
        //     animate(icon,this.offsetLeft);
        // }
        // function clickHandle(){
        //     //点击
        //     last = this.offsetLeft;
        // }
        // var last = 0; //点击时记录当前位置
        // function mouseoutHandle(){
        //     //离开
        //     animate(icon,last);
        // }



        //为变速动画函数添加一个任意改变的属性


        //写获取样式的一个属性的兼容
        function getStyle(ele, attr) {
            if (window.getComputedStyle) {
                return window.getComputedStyle(ele, null)[attr]; //xxx.left  ==  xxx["left"]
            } else {
                return ele.currentStyle[attr];
            }
        };

        //封装一个改变任意属性的动画函数
        // function animate(ele,attr,target){   //目标元素，样式，目标位置
        //     //清理定时器
        //     clearInterval(ele.timeId);
        //     ele.timeId = setInterval(function () {  
        //         //获取当前元素位置
        //         var current = parseInt(getStyle(ele,attr))      //转数字类型
        //         //移动的步数
        //         var step = (target-current)/10;
        //         //判断step是否为正数为正向上取整,负数是向下取整。
        //         step = step>0 ? Math.ceil(step) : Math.floor(step);
        //         current+=step;
        //         // 判断是否到达目标
        //         if(current == target){
        //             clearInterval(ele.timeId);
        //         }
        //         else {
        //             ele.style[attr] = current +"px";
        //         }

        //         //测试代码
        //         console.log("目标位置："+target+"当前位置："+current+"每次移动步数"+step)
        //     },20)
        // };

        // my$("btn1").onclick = function () {
        //     animate(my$("dv"),"width",400)
        // }

        //为变速动画函数添加多个任意改变的属性
        // my$("btn1").onclick = function () {
        //     animate(my$("dv"), {
        //         "width": 400,
        //         "height": 500,
        //         "top": 100,
        //         "left": 100
        //     })
        // }


        //封装可以添加任意多个属性的变速动画函数
        function animate(ele, json) { //目标元素，样式，目标位置
            //清理定时器
            clearInterval(ele.timeId);
            ele.timeId = setInterval(function () {
                var flag = true;
                for (var attr in json) {
                    //获取当前元素位置
                    var current = parseInt(getStyle(ele, attr)) //转数字类型
                    //当前的属性对应的值
                    var target = json[attr];
                    //移动的步数
                    var step = (target - current) / 10; //json[attr]就是这个属性的值
                    //判断step是否为正数为正向上取整,负数是向下取整。
                    step = step > 0 ? Math.ceil(step) : Math.floor(step);
                    current += step;
                    ele.style[attr] = current + "px";
                    // 判断是否到达目标
                    if (current != target) {
                        flag = false;
                    }
                }
                if (flag) {
                    clearInterval(ele.timeId);
                }
            }, 20)
        };
    
    
    
    //封装可以添加任意多个属性的变速动画函数再增加回调函数
    function animate(ele, json,fn) { //目标元素，样式，目标位置
            //清理定时器
            clearInterval(ele.timeId);
            ele.timeId = setInterval(function () {
                var flag = true;
                for (var attr in json) {
                    //获取当前元素位置
                    var current = parseInt(getStyle(ele, attr)) //转数字类型
                    //当前的属性对应的值
                    var target = json[attr];
                    //移动的步数
                    var step = (target - current) / 10; //json[attr]就是这个属性的值
                    //判断step是否为正数为正向上取整,负数是向下取整。
                    step = step > 0 ? Math.ceil(step) : Math.floor(step);
                    current += step;
                    ele.style[attr] = current + "px";
                    // 判断是否到达目标
                    if (current != target) {
                        flag = false;
                    }
                }
                if (flag) {
                    clearInterval(ele.timeId);   //所有属性准备完了才清理定时器
                    //然后触发回调函数，前提用户传入了这个函数
                    if(fn){
                        fn();
                    }
                };
            }, 20)
        };
    
        my$("btn1").onclick = function (){
            var json1 = {"width":400,"height":400,"left":300,"top":300};
            animate(my$("dv"),json1,function(){
                var json2 = {"width":100,"height":100,"left":10,"top":10}
                animate(my$("dv"),json2,function(){
                    var json3 = {"width":400,"height":400,"left":300,"top":300};
                    animate(my$("dv"),json3)
                });
            })
        }


        // setInterval(function(){
        //     var json1 = {"width":400,"height":400,"left":300,"top":300};
        //     animate(my$("dv"),json1,function(){
        //         var json2 = {"width":100,"height":100,"left":10,"top":10}
        //         animate(my$("dv"),json2);
        //     })
        // },1000);


        //封装可以添加任意多个属性的变速动画函数再增加回调函数再增加层级和透明度     最终形态
    function animate(ele, json,fn) { //目标元素，样式，目标位置
            //清理定时器   防止多次点击多从执行
            clearInterval(ele.timeId);
            ele.timeId = setInterval(function () {
                var flag = true;
                for (var attr in json) {
                    //判断是否有这个zIndex属性
                    if(attr == "zIndex"){
                        //层级改变只需要改变这个值
                        ele.style[attr] = json[attr];
                    }
                    //判断是否有这个opacity属性
                    else if(attr == "opacity"){
                    //获取当前元素的透明度
                    var current = getStyle(ele, attr)*100;  //将透明度增加100倍好计算     并且getStyle(ele, attr)是数字类型
                    //当前的属性对应的值
                    var target = json[attr]*100;
                    //移动的步数
                    var step = (target - current) / 10; //json[attr]就是这个属性的值
                    //判断step是否为正数为正向上取整,负数是向下取整。
                    step = step > 0 ? Math.ceil(step) : Math.floor(step);
                    current += step;
                    ele.style[attr] = current/100;    //计算完后还原回去
                    }
                    //普通的带px的属性
                    else{
                    //获取当前元素位置
                    var current = parseInt(getStyle(ele, attr)) //转数字类型
                    //当前的属性对应的值
                    var target = json[attr];
                    //移动的步数
                    var step = (target - current) / 10; //json[attr]就是这个属性的值
                    //判断step是否为正数为正向上取整,负数是向下取整。
                    step = step > 0 ? Math.ceil(step) : Math.floor(step);
                    current += step;
                    ele.style[attr] = current + "px";
                    }
                    // 判断是否到达目标
                    if (current != target) {
                        flag = false;
                    }
                }
            if (flag) {
                clearInterval(ele.timeId);   //所有属性准备完了才清理定时器
                //然后触发回调函数，前提用户传入了这个函数
                if(fn){
                    fn();
                }
            };
        }, 20)
    };
    </script>
</body>

</html>